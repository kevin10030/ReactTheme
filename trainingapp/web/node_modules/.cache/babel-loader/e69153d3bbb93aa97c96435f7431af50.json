{"ast":null,"code":"var _jsxFileName = \"D:\\\\CSH\\\\A\\\\IoT\\\\Web\\\\Training\\\\trainingapp\\\\web\\\\src\\\\modules\\\\courses\\\\Payments.jsx\";\nimport React from \"react\";\nimport { CButton, CCard, CCardBody, CCardHeader, CCardFooter, CCol, CRow, CDataTable, CForm, CFormGroup, CFormText, CLink, CInput, CLabel, CSelect, CInputGroup, CInputGroupPrepend, CInputGroupText } from '@coreui/react';\nimport { useSelector, useDispatch } from 'react-redux';\nimport MuiAlert from '@material-ui/lab/Alert';\nimport Snackbar from '@material-ui/core/Snackbar';\nimport CIcon from '@coreui/icons-react';\nimport axios from 'axios';\nimport Config from '../../common/Config';\n\nfunction Alert(props) {\n  return /*#__PURE__*/React.createElement(MuiAlert, Object.assign({\n    elevation: 6\n  }, props, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 27,\n      columnNumber: 10\n    }\n  }));\n}\n\nexport default function Payments() {\n  const {\n    useState\n  } = React;\n  const [currentPage, setCurrentPage] = useState(1);\n  const [currentPagination, setCurrentPagination] = useState(5);\n\n  const getLastVal = currentPage => {\n    if (currentPage * currentPagination < paymentList.length) return currentPage * currentPagination;\n    return paymentList.length;\n  }; // paymentid(S),  orderitemid(S),  useremail(S),  courseid(S),   chargeid(S),  is_refunded(N),  updatedby(S), updatedtime(S)\n  // refundid(S), paymentid(S), amount(S),  updatedby(S),  updatedtime(S)\n\n\n  const fields = [{\n    key: 'useremail',\n    label: 'User Email',\n    _style: {\n      width: '15%'\n    }\n  }, {\n    key: 'coursename',\n    label: 'Course Name',\n    _style: {\n      width: '20%'\n    }\n  }, {\n    key: 'amount',\n    label: 'Amount',\n    _style: {\n      width: '10%'\n    }\n  }, {\n    key: 'paymenttime',\n    label: 'Payment Time',\n    _style: {\n      width: '20%'\n    }\n  }, {\n    key: 'refundtime',\n    label: 'Refund Time',\n    _style: {\n      width: '20%'\n    }\n  }, {\n    key: 'adminemail',\n    label: 'Admin Email',\n    _style: {\n      width: '15%'\n    }\n  }];\n  const [adminid, setAdminId] = React.useState(\"adminid\");\n  const [toast, showToast] = React.useState(false);\n  const [toastMessage, setToastMessage] = React.useState('');\n  const [toastClass, setToastClass] = React.useState('success');\n  const [isLoading, setIsLoading] = React.useState(false);\n  const [paymentList, setPaymentList] = React.useState([]);\n  const [courseList, setCourseList] = React.useState([]);\n  const [refundList, setRefundList] = React.useState([]);\n  React.useEffect(() => {\n    getCourseList();\n  }, []);\n\n  const getPaymentList = async (courselist, refundlist) => {\n    setIsLoading(true);\n    axios({\n      url: process.env.REACT_APP_AWS_API_ENDPOINT + '/paymentall',\n      method: 'get'\n    }).then(response => response.data).then(data => {\n      const list = data.sort((a, b) => a.updatedtime > b.updatedtime ? -1 : 1); //Descending\n\n      console.log(list);\n\n      for (var i = 0; i < list.length; i++) {\n        const course = courselist.find(course => course.courseid === list[i].courseid);\n\n        if (course) {\n          list[i]['coursename'] = course.coursename;\n          list[i]['amount'] = course.price + \" \" + course.currency;\n        }\n\n        list[i]['paymenttime'] = getDateTimeString(list[i].updatedtime);\n        list[i]['refundtime'] = '';\n        list[i]['adminemail'] = '';\n\n        if (list[i].is_refunded == 1) {\n          const refund = refundlist.find(refund => refund.paymentid === list[i].paymentid);\n\n          if (refund) {\n            list[i]['refundtime'] = getDateTimeString(refund.updatedtime);\n            list[i]['adminemail'] = refund.adminemail;\n          }\n        }\n      }\n\n      setPaymentList(list);\n      setIsLoading(false);\n    }).catch(error => {\n      setIsLoading(false);\n    });\n  };\n\n  const getRefundList = async courselist => {\n    setIsLoading(true);\n    const list = await axios({\n      url: process.env.REACT_APP_AWS_API_ENDPOINT + '/refund',\n      method: 'get'\n    }).then(response => response.data).then(data => {\n      const list = data.sort((a, b) => a.updatedtime > b.updatedtime ? 1 : -1);\n      console.log(list);\n      setIsLoading(false);\n      return list;\n    }).catch(error => {\n      setIsLoading(false);\n    });\n    setRefundList(list);\n    getPaymentList(courselist, list);\n  };\n\n  const getCourseList = async () => {\n    setIsLoading(true);\n    const list = await axios({\n      url: Config.BACKEND_API_URL + '/course',\n      method: 'get'\n    }).then(function (response) {\n      const list = response.data.sort((a, b) => a.updatedtime > b.updatedtime ? 1 : -1);\n      console.log(list);\n      setIsLoading(false);\n      return list;\n    }).catch(function (error) {\n      console.log(error.response);\n      setIsLoading(false);\n    });\n    setCourseList(list);\n    getRefundList(list);\n  };\n\n  function getDateTimeString(timestamp) {\n    const date = new Date(Number(timestamp));\n    return date.toLocaleString(\"en-US\");\n  }\n\n  return /*#__PURE__*/React.createElement(\"div\", {\n    className: \"animated fadeIn\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 151,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(CRow, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 152,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(CCol, {\n    xl: \"12\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 153,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(CCard, {\n    custom: true,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 154,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(CCardHeader, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 155,\n      columnNumber: 13\n    }\n  }, \"Payment Transactions\"), /*#__PURE__*/React.createElement(CCardBody, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 158,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(CDataTable, {\n    items: paymentList,\n    fields: fields // columnFilter\n    ,\n    tableFilter: true // footer\n    ,\n    itemsPerPageSelect: false,\n    itemsPerPage: currentPagination,\n    dark: false,\n    hover: false,\n    border: false,\n    outlined: false,\n    loading: false,\n    sorter: false // clickableRows\n    ,\n    pagination: {\n      doubleArrows: true,\n      align: 'center'\n    },\n    loading: isLoading // onRowClick={(item,index,col,e) => {console.log(item,index,col,e)}}\n    ,\n    onPageChange: val => {\n      setCurrentPage(val);\n    } // onPagesChange={(val) => console.log('new pages:', val)}\n    ,\n    onPaginationChange: val => {\n      setCurrentPagination(val);\n    } // onFilteredItemsChange={(val) => console.log('new filtered items:', val)}\n    // onSorterValueChange={(val) => console.log('new sorter value:', val)}\n    // onTableFilterChange={(val) => console.log('new table filter:', val)}\n    // onColumnFilterChange={(val) => console.log('new column filter:', val)}\n    ,\n    scopedSlots: {},\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 159,\n      columnNumber: 15\n    }\n  }), /*#__PURE__*/React.createElement(CRow, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 193,\n      columnNumber: 15\n    }\n  }, /*#__PURE__*/React.createElement(CCol, {\n    xs: \"9\",\n    md: \"8\",\n    style: {\n      alignSelf: \"center\",\n      display: 'flex'\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 194,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(\"spin\", {\n    style: {\n      marginTop: \"5px\",\n      marginRight: \"5px\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 195,\n      columnNumber: 21\n    }\n  }, \"Items per page:\"), /*#__PURE__*/React.createElement(CSelect, {\n    name: \"itemsperpage\",\n    id: \"itemsperpage\",\n    style: {\n      width: \"70px\"\n    },\n    onChange: e => setCurrentPagination(e.target.value),\n    value: currentPagination,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 196,\n      columnNumber: 21\n    }\n  }, /*#__PURE__*/React.createElement(\"option\", {\n    value: \"5\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 202,\n      columnNumber: 23\n    }\n  }, \"5\"), /*#__PURE__*/React.createElement(\"option\", {\n    value: \"10\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 203,\n      columnNumber: 23\n    }\n  }, \"10\"), /*#__PURE__*/React.createElement(\"option\", {\n    value: \"15\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 204,\n      columnNumber: 23\n    }\n  }, \"15\"), /*#__PURE__*/React.createElement(\"option\", {\n    value: \"20\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 205,\n      columnNumber: 23\n    }\n  }, \"20\"))), /*#__PURE__*/React.createElement(CCol, {\n    xs: \"3\",\n    md: \"4\",\n    style: {\n      alignSelf: \"center\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 208,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    style: {\n      textAlign: 'right'\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 209,\n      columnNumber: 19\n    }\n  }, /*#__PURE__*/React.createElement(\"spin\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 210,\n      columnNumber: 21\n    }\n  }, (currentPage - 1) * currentPagination + 1 + '-' + getLastVal(currentPage) + ' of ' + paymentList.length))))))), /*#__PURE__*/React.createElement(CCol, {\n    sm: \"12\",\n    lg: \"6\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 221,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(Snackbar, {\n    anchorOrigin: {\n      vertical: 'top',\n      horizontal: 'center'\n    },\n    open: toast,\n    autoHideDuration: 10000,\n    onClose: () => {\n      showToast(false);\n      getPaymentList();\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 222,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(Alert, {\n    severity: toastClass,\n    action: /*#__PURE__*/React.createElement(CButton, {\n      onClick: e => {\n        e.preventDefault();\n        showToast(false);\n        getPaymentList();\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 230,\n        columnNumber: 17\n      }\n    }, /*#__PURE__*/React.createElement(CIcon, {\n      name: \"cil-x\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 230,\n        columnNumber: 105\n      }\n    })),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 227,\n      columnNumber: 13\n    }\n  }, toastMessage)))));\n}","map":{"version":3,"sources":["D:/CSH/A/IoT/Web/Training/trainingapp/web/src/modules/courses/Payments.jsx"],"names":["React","CButton","CCard","CCardBody","CCardHeader","CCardFooter","CCol","CRow","CDataTable","CForm","CFormGroup","CFormText","CLink","CInput","CLabel","CSelect","CInputGroup","CInputGroupPrepend","CInputGroupText","useSelector","useDispatch","MuiAlert","Snackbar","CIcon","axios","Config","Alert","props","Payments","useState","currentPage","setCurrentPage","currentPagination","setCurrentPagination","getLastVal","paymentList","length","fields","key","label","_style","width","adminid","setAdminId","toast","showToast","toastMessage","setToastMessage","toastClass","setToastClass","isLoading","setIsLoading","setPaymentList","courseList","setCourseList","refundList","setRefundList","useEffect","getCourseList","getPaymentList","courselist","refundlist","url","process","env","REACT_APP_AWS_API_ENDPOINT","method","then","response","data","list","sort","a","b","updatedtime","console","log","i","course","find","courseid","coursename","price","currency","getDateTimeString","is_refunded","refund","paymentid","adminemail","catch","error","getRefundList","BACKEND_API_URL","timestamp","date","Date","Number","toLocaleString","doubleArrows","align","val","alignSelf","display","marginTop","marginRight","e","target","value","textAlign","vertical","horizontal","preventDefault"],"mappings":"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","sourcesContent":["import React from \"react\";\r\n\r\nimport {\r\n  CButton,\r\n  CCard,\r\n  CCardBody,\r\n  CCardHeader,\r\n  CCardFooter,\r\n  CCol,\r\n  CRow, CDataTable, CForm, CFormGroup, CFormText, CLink, CInput, CLabel, CSelect,\r\n  CInputGroup,\r\n  CInputGroupPrepend,\r\n  CInputGroupText,\r\n} from '@coreui/react'\r\n\r\nimport { useSelector, useDispatch } from 'react-redux';\r\n\r\nimport MuiAlert from '@material-ui/lab/Alert';\r\nimport Snackbar from '@material-ui/core/Snackbar';\r\n\r\n\r\nimport CIcon from '@coreui/icons-react'\r\nimport axios from 'axios';\r\nimport Config from '../../common/Config'\r\n\r\nfunction Alert(props) {\r\n  return <MuiAlert elevation={6} {...props} />;\r\n}\r\n\r\n\r\nexport default function Payments() {\r\n  const { useState } = React;\r\n\r\n  const [currentPage, setCurrentPage] = useState(1)\r\n  const [currentPagination, setCurrentPagination] = useState(5)\r\n  const getLastVal = (currentPage) => {\r\n    if (currentPage * currentPagination < paymentList.length)\r\n      return currentPage * currentPagination;\r\n    return paymentList.length;\r\n  }\r\n\r\n  // paymentid(S),  orderitemid(S),  useremail(S),  courseid(S),   chargeid(S),  is_refunded(N),  updatedby(S), updatedtime(S)\r\n  // refundid(S), paymentid(S), amount(S),  updatedby(S),  updatedtime(S)\r\n  const fields = [\r\n    { key: 'useremail', label:'User Email', _style: { width: '15%' } },\r\n    { key: 'coursename', label:'Course Name', _style: { width: '20%' } },\r\n    { key: 'amount', label:'Amount', _style: { width: '10%' } },\r\n    { key: 'paymenttime', label:'Payment Time', _style: { width: '20%' } },\r\n    { key: 'refundtime', label:'Refund Time', _style: { width: '20%' } },\r\n    { key: 'adminemail', label:'Admin Email', _style: { width: '15%' } },   \r\n  ]\r\n\r\n  const [adminid, setAdminId] = React.useState(\"adminid\")\r\n\r\n  const [toast, showToast] = React.useState(false);\r\n  const [toastMessage, setToastMessage] = React.useState('');\r\n  const [toastClass, setToastClass] = React.useState('success');\r\n\r\n  const [isLoading, setIsLoading] = React.useState(false);\r\n  const [paymentList, setPaymentList] = React.useState([])\r\n  const [courseList, setCourseList] = React.useState([])\r\n  const [refundList, setRefundList] = React.useState([])\r\n\r\n  React.useEffect(() => {\r\n    getCourseList();\r\n  }, []);\r\n\r\n  const getPaymentList = async (courselist, refundlist) => {\r\n    setIsLoading(true)\r\n    \r\n    axios({\r\n      url: process.env.REACT_APP_AWS_API_ENDPOINT + '/paymentall',\r\n      method: 'get'\r\n    }).then(response => response.data).then((data) => {      \r\n      const list = data.sort((a, b) => a.updatedtime > b.updatedtime ? -1 : 1) //Descending\r\n      console.log(list)           \r\n\r\n      for(var i=0;i<list.length;i++) {\r\n        const course  = courselist.find(course => course.courseid === list[i].courseid)\r\n        if(course) {\r\n          list[i]['coursename'] = course.coursename\r\n          list[i]['amount'] = course.price + \" \" + course.currency\r\n        }\r\n        list[i]['paymenttime'] =  getDateTimeString(list[i].updatedtime)\r\n\r\n        list[i]['refundtime'] = ''\r\n        list[i]['adminemail'] = ''\r\n        if(list[i].is_refunded == 1) {\r\n          const refund = refundlist.find(refund=>refund.paymentid===list[i].paymentid)\r\n          if(refund) {\r\n            list[i]['refundtime'] = getDateTimeString( refund.updatedtime)\r\n            list[i]['adminemail'] = refund.adminemail\r\n          }\r\n        }\r\n      }\r\n      setPaymentList(list);\r\n      setIsLoading(false)\r\n\r\n    }).catch(error => { \r\n      setIsLoading(false)\r\n    });\r\n  };\r\n\r\n  const getRefundList = async (courselist) => {\r\n    setIsLoading(true)    \r\n    const list = await axios({\r\n      url: process.env.REACT_APP_AWS_API_ENDPOINT + '/refund',\r\n      method: 'get'\r\n    }).then(response => response.data).then((data) => {\r\n      const list = data.sort((a, b) => a.updatedtime > b.updatedtime ? 1 : -1)\r\n      console.log(list)\r\n      \r\n      setIsLoading(false)\r\n      return list\r\n    }).catch(error => { \r\n      setIsLoading(false)\r\n    });\r\n\r\n    setRefundList(list);\r\n    getPaymentList(courselist, list);\r\n  };\r\n\r\n  const getCourseList = async () => {\r\n    setIsLoading(true)\r\n    const list = await axios({\r\n      url: Config.BACKEND_API_URL+'/course',\r\n      method: 'get'\r\n    })\r\n    .then(function (response) {      \r\n      const list = response.data.sort((a, b) => a.updatedtime > b.updatedtime ? 1 : -1)\r\n      console.log(list)      \r\n      setIsLoading(false)\r\n      return list;\r\n    })\r\n    .catch(function (error) {\r\n      console.log(error.response)\r\n      setIsLoading(false)\r\n     });\r\n\r\n     setCourseList(list);      \r\n     getRefundList(list);\r\n  };\r\n\r\n  function getDateTimeString(timestamp)\r\n  {\r\n    const date =  new Date(Number(timestamp));\r\n    return date.toLocaleString(\"en-US\");\r\n  }\r\n\r\n  return (\r\n    <div className=\"animated fadeIn\">\r\n      <CRow>\r\n        <CCol xl=\"12\">\r\n          <CCard custom>\r\n            <CCardHeader >\r\n              Payment Transactions\r\n            </CCardHeader>\r\n            <CCardBody>\r\n              <CDataTable\r\n                items={paymentList}\r\n                fields={fields}\r\n                // columnFilter\r\n                tableFilter\r\n                // footer\r\n                itemsPerPageSelect={false}\r\n                itemsPerPage={currentPagination}\r\n                dark={false}\r\n                hover={false}\r\n                border={false}\r\n                outlined={false}\r\n                loading={false}\r\n                sorter={false}\r\n                // clickableRows\r\n                pagination={{ doubleArrows: true, align: 'center' }}\r\n                loading={isLoading}\r\n                // onRowClick={(item,index,col,e) => {console.log(item,index,col,e)}}\r\n                onPageChange={(val) => {\r\n                  setCurrentPage(val)\r\n                }\r\n                }\r\n                // onPagesChange={(val) => console.log('new pages:', val)}\r\n                onPaginationChange={(val) => {\r\n                  setCurrentPagination(val);\r\n                }}\r\n                // onFilteredItemsChange={(val) => console.log('new filtered items:', val)}\r\n                // onSorterValueChange={(val) => console.log('new sorter value:', val)}\r\n                // onTableFilterChange={(val) => console.log('new table filter:', val)}\r\n                // onColumnFilterChange={(val) => console.log('new column filter:', val)}\r\n\r\n                scopedSlots={{                \r\n                }}\r\n              />\r\n              <CRow>\r\n                <CCol xs=\"9\" md=\"8\" style={{alignSelf:\"center\", display:'flex'}}>                  \r\n                    <spin style={{marginTop:\"5px\", marginRight:\"5px\"}}>Items per page:</spin>\r\n                    <CSelect \r\n                      name=\"itemsperpage\" \r\n                      id=\"itemsperpage\" \r\n                      style={{width:\"70px\"}} \r\n                      onChange={e => setCurrentPagination(e.target.value)}\r\n                      value={currentPagination}>\r\n                      <option value=\"5\">5</option>\r\n                      <option value=\"10\">10</option>\r\n                      <option value=\"15\">15</option>\r\n                      <option value=\"20\">20</option>\r\n                    </CSelect>\r\n                </CCol>\r\n                <CCol xs=\"3\" md=\"4\" style={{alignSelf:\"center\"}}>\r\n                  <div  style={{textAlign: 'right' }}>\r\n                    <spin>\r\n                    {                      \r\n                      ((currentPage - 1) * currentPagination + 1) + '-' + getLastVal(currentPage) + ' of ' + paymentList.length\r\n                    }\r\n                    </spin>\r\n                  </div>\r\n                </CCol>\r\n              </CRow>\r\n            </CCardBody>\r\n          </CCard>\r\n        </CCol>        \r\n        <CCol sm=\"12\" lg=\"6\">\r\n          <Snackbar\r\n            anchorOrigin={{ vertical: 'top', horizontal: 'center' }}\r\n            open={toast}\r\n            autoHideDuration={10000}\r\n            onClose={() => { showToast(false); getPaymentList(); }}>\r\n            <Alert\r\n              severity={toastClass}\r\n              action={\r\n                <CButton  onClick={(e) => { e.preventDefault(); showToast(false); getPaymentList();  }}><CIcon name=\"cil-x\" /></CButton>\r\n              }\r\n            >\r\n              {toastMessage}\r\n            </Alert>\r\n          </Snackbar>\r\n        </CCol>\r\n      </CRow>\r\n    </div>\r\n  )\r\n}\r\n"]},"metadata":{},"sourceType":"module"}